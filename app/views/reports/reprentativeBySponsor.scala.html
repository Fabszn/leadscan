<div class="page-header">

    <div class="row" >
        <div class="row" >
            <div class="col-md-12">
                    &nbsp;
            </div>
        </div>

        <div class="col-md-12">

                &nbsp;
        </div>
    </div>

    <div class="row" >

        <div class="col-md-4" id="formNewVue">

            <div class="col-md-6" id="errorMessage" v-if="isError">
                <div class="alert alert-danger" v-model="message" role="alert">{{message}}</div>
            </div>
                <div class="panel panel-default" >

                    <div>
                        <h3><span class="label label-default" >Add Representative</span></h3>
                    </div>
                    <div class="panel-body" >
                        <div class="form-group">
                            <input type="text" class="form-control newcheckForm" v-model="firstname" placeholder="Firstname">
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control newcheckForm" v-model="lastname" placeholder="Lastname">
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control newcheckForm" v-model="email" placeholder="Email">
                        </div>
                       <!-- <div class="form-group">
                            <input type="text" class="form-control newcheckForm" v-model="company" placeholder="Company">
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control newcheckForm" v-model="title" placeholder="Title">
                        </div>-->
                        <div class="form-group">
                            <button type="button" class="btn btn-default" v-on:click="add" >Save</button>
                            <button type="button" class="btn btn-default" v-on:click="cancel" >Cancel</button>
                        </div>
                    </div>
                </div>

        </div>
        <div class="col-md-8">
            <table id="person" class="display">
                <thead>
                    <tr>
                        <th>RegId</th>
                        <th>Firstname / Lastname</th>
                        <th>Email</th>
                        <th>Sponsor</th>
                        <th>IdSponsor</th>
                    </tr>
                </thead>
                <tbody>
            </tbody>
            </table>
        </div>
    </div>
</div>


<script>

        $(function () {

            var eVue = new Vue({
                el: "#errorMessage",
                data: {
                    isError: false,
                    message: ""
                }
            });



            var newRepresentativeVue = new Vue({
                el: "#formNewVue",
                data: {
                    firstname: "",
                    lastname: "",
                    email: "",
                    company: "",
                    title: "",
                    show: true
                }, methods: {
                    cancel: function (e) {
                        newRepresentativeVue.firstname = "";
                        newRepresentativeVue.lastname = "";
                        newRepresentativeVue.email = "";
                        newRepresentativeVue.company = "-";
                        newRepresentativeVue.title = "-";
                    },
                    add: function (e) {
                        if (isNoError('newcheckForm')) {
                            $.ajax({
                                url: "/reports/representatives/new",
                                type: 'POST',
                                data: JSON.stringify({
                                    firstname: newRepresentativeVue.firstname,
                                    lastname: newRepresentativeVue.lastname,
                                    email: newRepresentativeVue.email,
                                    company: newRepresentativeVue.company,
                                    title: newRepresentativeVue.title
                                }),
                                async: true,
                                success: function (data) {

                                    sponsorDatatable.ajax.reload(false);
                                    newRepresentativeVue.firstname = "";
                                    newRepresentativeVue.lastname = "";
                                    newRepresentativeVue.email = "";
                                    newRepresentativeVue.company = "";
                                    newRepresentativeVue.title = "";
                                },
                                error: function (e) {
                                    console.error(e);
                                },
                                cache: false,
                                contentType: 'application/json',
                                processData: false
                            });


                        }
                    }
                }
            });

            function isNoError(classId) {
                var isError = false;
                _.each($('.' + classId), function (r) {
                    if ($(r).val() == "" || $(r).val() == null) {
                        isError = true;
                        $(r).addClass('inputError');
                        eVue.isError = true;
                        eVue.message = "Please fill missed field(s))";
                    } else {
                        $(r).removeClass('inputError');
                    }

                    if (!isError) {
                        eVue.isError = false;
                    }
                });
                return !isError
            }


            var sponsorDatatable = $('#person').DataTable({
                "bServerSide": false,
                "ajax": {url: "/reports/representatives_by_sponsor"},
                "columnDefs": [
                    {"visible": true, "targets": 0},
                    {"visible": true, "targets": 1},
                    {"visible": true, "targets": 2},
                    {"visible": true, "targets": 3},
                    {"visible": false, "targets": 4}
                ]
            });

            console.log(sponsorDatatable.columns(4).data());


        })

</script>